<form class="row" #f="ngForm">

  <div ngModelGroup="recordData">

    <div class="col s9">

      <!-- Waveform -->

      <div class="valign-wrapper">
        <div class="row">
          <div id="waveform" class="z-depth-2"></div>
        </div>
      </div>

      <div class="row">

        <div class="col s6">
          <!-- Attachment file input -->
          <div class="btn indigo darken-1 file-field input-field col s6 addFileButton">
            {{selectedRecord ? (selectedRecord.filenames.length - 1) + ' fichier(s)' : files.length + ' fichier(s)'}}
            <input type="file" id="file" name="file" (change)="getFiles($event)" ngModel multiple>
            <i class="material-icons left">attach_file</i>
          </div>

          <!-- Play/Pause button -->

          <i *ngIf="!wavesurfer.isPlaying()" (click)="playPause()" class="material-icons col s2 offset-s3 iconButton">play_arrow</i>
          <i *ngIf="wavesurfer.isPlaying()" (click)="playPause()" class="material-icons col s2 offset-s3 iconButton">pause</i>

        </div>

        <div class="col s6">

          <!-- Record button -->

          <a (click)="startStopRecording()" class="col s2 recButton"
             [ngClass]="isRecording ? 'Rec' : 'notRec'"></a>

          <!-- Annotations button -->

          <a class="btn indigo darken-1 offset-s4 col s6" (click)="showHide()"><i class="material-icons left">turned_in</i>{{annotationsVisible ? 'Propriétés' : 'Annotations'}}</a>
        </div>


      </div>

      <hr>

      <!-- Add Annotation -->
      <div *ngIf="annotationsVisible" class="col s12">
        <div class="input-field col s4">
          <i class="material-icons prefix">access_time</i>
          <input id="fixTime" type="text" name="fixTime"
                 [value]="prettyPrintDuration(annotationTime)" readonly required/>
          <label class="active" for="fixTime">Temps</label>
        </div>
        <div class="input-field col s8">
          <i class="material-icons prefix">edit</i>
          <textarea id="note" type="text" name="note" required #newAnnotation></textarea>
        </div>

        <!-- Validate annotation -->
        <a class="btn indigo darken-1 col s4 center margin" (click)="addAnnotation(newAnnotation)">Valider</a>


        <!-- Annotations list -->
        <div class="col s12">
          <div *ngFor="let note of annotations; let i = index" class="row pointer" (click)="playAtTime(note.time)">
            <i class="material-icons col s1">collections_bookmark</i>
            <span class="col s1">{{this.prettyPrintDuration(note.time)}}</span>
            <span class="col s8 push-s1 center">{{note.content}}</span>
            <i class="material-icons col s1 offset-s1" (click)="deleteAnnotation(i)">delete</i>
          </div>
        </div>
      </div>


      <!-- Duration / name -->

      <div *ngIf="!annotationsVisible" class="col s12">
        <div class="row">
          <div class="input-field col s3">
            <i class="material-icons prefix">timer</i>
            <input id="duration" type="text" name="duration"
                   [value]="prettyPrintDuration(recordService.temporaryDuration)" required readonly/>
            <label class="active" for="duration">Durée</label>
          </div>
          <div class="input-field col s5 offset-s3">
            <i class="material-icons prefix">label_outline</i>
            <input id="name" type="text" name="name" [ngModel]="selectedRecord ? selectedRecord.name : ''" required/>
            <label class="active" for="name">Nom</label>
          </div>
        </div>


        <!-- Type / Orator mail -->

        <div class="row">
          <div class="input-field col s3 custom-select">
            <i class="material-icons prefix">unfold_more</i>
            <select materialize="material_select" [materializeSelectOptions]="recordService.selectOptions" id="type"
                    name="type"
                    [ngModel]="selectedRecord ? selectedRecord.type : defaultType">
              <option *ngFor="let option of recordService.selectOptions" [value]="option">{{option}}</option>
            </select>
            <label for="type">Type</label>
          </div>
          <div class="input-field col s5 offset-s3">
            <i class="material-icons prefix">mic_none</i>
            <input id="oratorMail" type="text" name="oratorMail" (keyup)="searchUsers($event)" autocomplete="off"
                   [ngModel]="selectedRecord ? selectedRecord.oratorMail : ''"
                   materialize="autocomplete" [materializeParams]="[{'data': oratorList}]" email required/>
            <label class="active" for="oratorMail">Mail
              Orateur</label>
          </div>
        </div>
      </div>
    </div>


    <div class="col s3">

      <!-- Tags -->

      <div class="tagform z-depth-2">
        <div *ngFor="let chip of tags; let i = index" class="row">
          <i class="material-icons col s1 offset-s1">local_offer</i>
          <span class="col s6 offset-s1">{{chip}}</span>
          <i class="material-icons col s1" (click)="deleteTag(i)">delete</i>
        </div>
        <div class="row input-field">
          <input placeholder="Ajouter un tag..." class="col s8 offset-s1" type="text" (keyup.enter)="addTag(newTagInput)" #newTagInput/>
          <i class="material-icons col s2 addTagIcon" (click)="addTag(newTagInput)">add_box</i>
        </div>
      </div>

      <br>
      <hr>
      <br>

      <!-- Validation buttons  -->

      <a *ngIf="selectedRecord == null" class="waves-effect waves-light btn col s10 indigo darken-1"
         [ngClass]="{' disabled' : loadingService.isUploading}"
         type="submit" (click)="onCreate()">Créer</a>
      <a *ngIf="selectedRecord != null" class="waves-effect waves-light btn col s10 indigo darken-1"
         [ngClass]="{' disabled' : loadingService.isUploading}"
         type="submit" (click)="onUpdate()">Modifier</a>

      <!-- Reset form button -->

      <i (click)="recordService.uneditRecord()" class="material-icons prefix col s2 resetForm">delete_sweep</i>

    </div>

  </div>

</form>
